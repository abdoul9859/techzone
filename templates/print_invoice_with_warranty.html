<!DOCTYPE html>
<html lang="fr" style="margin:0;padding:0;width:100%;height:100%;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facture {{ invoice.invoice_number }} avec Garantie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        :root {
            --primary-color: #000000;
            --secondary-color: #4b5563;
            --border-color: #e5e7eb;
            --text-main: #111827;
            --text-muted: #6b7280;
            --bg-light: #f9fafb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html, body {
            margin: 0 !important; padding: 0 !important; width: 100% !important; min-height: 100vh !important; background-color: #f3f4f6;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif; line-height: 1.5; font-size: 10.5pt; color: var(--text-main); display: flex; flex-direction: column; align-items: center;
        }

        .page-controls { position: fixed; top: 20px; left: 0; right: 0; display: flex; justify-content: center; gap: 12px; z-index: 1000; }
        .page-controls .btn { padding: 10px 20px; border-radius: 6px; font-weight: 600; font-size: 14px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-print { background-color: #111827; color: #fff; }
        .btn-print:hover { background-color: #000; }
        .btn-return { background-color: #fff; color: #111827; border: 1px solid #d1d5db !important; }
        .btn-return:hover { background-color: #f9fafb; }

        .page-container { display: flex; justify-content: center; padding: 80px 0 40px; width: 100%; }

        @media print {
            html, body { background-color: #fff !important; width: 210mm; }
            .page-container { padding: 0 !important; margin: 0 !important; }
            #invoice-container { box-shadow: none !important; border: none !important; margin: 0 !important; width: 210mm !important; }
            .no-print { display: none !important; }
            @page { size: A4; margin: 12mm 12mm 15mm 12mm; }
            
            .footer { 
                position: static !important;
                width: auto; 
                height: auto; 
                padding: 10mm 0 0; 
                margin-top: 10mm !important;
                border-top: 1px solid var(--border-color);
                background: transparent !important;
            }
            .warranty-page {
                page-break-before: always !important;
                break-before: always !important;
                page-break-inside: avoid !important;
                break-inside: avoid-page !important;
            }
        }

        .container-a4 { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: #fff; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); 
            display: flex; 
            flex-direction: column; 
            padding: 30px 40px; /* Marges optimisées */
        }

        /* Header */
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 40px; 
            padding-bottom: 25px;
            border-bottom: 2px solid #000;
        }
        .company-section { flex: 1; }
        .logo { max-width: 220px; max-height: 100px; object-fit: contain; margin-bottom: 10px; }
        .company-info h1 { font-size: 32px; font-weight: 900; letter-spacing: -0.04em; margin-bottom: 2px; text-transform: uppercase; color: #000; }
        .company-info p { font-size: 11px; color: var(--text-muted); line-height: 1.4; margin: 0; }

        .doc-info { 
            text-align: right; 
            background: #fdfdfd;
            padding: 20px 30px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            min-width: 240px;
        }
        .doc-type { font-size: 26px; font-weight: 800; letter-spacing: 0.05em; color: #000; margin-bottom: 5px; text-transform: uppercase; }
        .doc-number { font-size: 18px; font-weight: 600; color: var(--secondary-color); margin: 0; }
        .doc-date { font-size: 12px; color: var(--text-muted); margin-top: 10px; font-weight: 500; }

        /* Billing Section */
        .details-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 50px; margin-bottom: 40px; }
        .detail-section-title { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .client-info p { margin-bottom: 4px; font-size: 14px; color: #333; }
        .client-name { font-weight: 800; font-size: 18px !important; color: #000; margin-bottom: 8px !important; }

        .meta-box { background: #fafafa; padding: 18px; border-radius: 10px; border: 1px solid #eee; }
        .meta-item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; }
        .meta-item:last-child { margin-bottom: 0; }
        .meta-label { color: var(--text-muted); font-weight: 500; }
        .meta-value { font-weight: 700; color: #000; }

        /* Products Table */
        .table-container { flex: 1; margin-bottom: 40px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 10px; font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); border-bottom: 2px solid #000; }
        td { padding: 16px 10px; border-bottom: 1px solid #eee; vertical-align: top; }
        
        .col-desc { width: 60%; }
        .col-qty { width: 10%; text-align: center; font-weight: 600; }
        .col-price { width: 15%; text-align: right; }
        .col-total { width: 15%; text-align: right; font-weight: 700; }

        .item-name { font-weight: 700; font-size: 14.5px; margin-bottom: 5px; color: #000; }
        .item-meta { font-size: 11px; color: var(--text-muted); font-family: monospace; }
        .section-row td { background-color: #fcfcfc; font-weight: 800; text-transform: uppercase; font-size: 12px; color: #000; border-bottom: 1px solid #eee; }
        .section-total-row td { font-style: italic; font-weight: 600; text-align: right; background-color: #fff; border-bottom: 1px solid #eee; color: var(--text-muted); font-size: 12px; }

        /* Totals */
        .summary-section { display: flex; justify-content: flex-end; margin-top: 20px; }
        .totals-table { width: 340px; }
        .totals-row { display: flex; justify-content: space-between; padding: 10px 0; font-size: 14px; border-bottom: 1px dashed #eee; }
        .totals-row:last-of-type { border-bottom: none; }
        .totals-row.grand-total { border-top: 2px solid #000; border-bottom: none; margin-top: 10px; padding-top: 15px; font-weight: 900; font-size: 24px; color: #000; }
        .totals-row.payment { color: #059669; font-weight: 700; background: #ecfdf5; padding: 8px 12px; border-radius: 6px; margin-top: 5px; }
        .totals-row.due { color: #dc2626; font-weight: 800; border-top: 1px solid #fee2e2; margin-top: 5px; background: #fef2f2; padding: 8px 12px; border-radius: 6px; }

        /* Signature */
        .signature-section { margin-top: 60px; display: flex; justify-content: flex-end; padding-right: 20px; }
        .signature-box { width: 280px; text-align: center; }
        .signature-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 20px; }
        .signature-line { border-bottom: 1px solid #000; height: 80px; margin-bottom: 10px; position: relative; }
        .signature-img { max-width: 240px; max-height: 100px; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); }

        /* Footer */
        .footer { margin-top: auto; padding-top: 40px; border-top: 1px solid #000; }
        .footer-grid { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 40px; }
        .footer-col h4 { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px; color: #000; }
        .footer-col p { font-size: 11px; color: var(--text-muted); line-height: 1.6; margin: 0; }
        .footer-bottom { margin-top: 30px; padding-top: 15px; border-top: 1px solid #eee; text-align: center; font-size: 10px; color: #999; letter-spacing: 0.02em; }

        /* Warranty Page Specific */
        .warranty-page {
            width: 210mm;
            padding: 30px 40px;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            min-height: 297mm;
        }
        .w-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding-bottom: 25px; border-bottom: 2px solid #000; }
        .w-title { font-size: 26px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; color: #000; }
        .w-badge { background: #000; color: #fff; padding: 6px 15px; border-radius: 8px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; }
        
        .w-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .w-card { border: 1px solid #eee; border-radius: 12px; padding: 25px; background: #fafafa; }
        .w-item { display: flex; flex-direction: column; margin-bottom: 15px; }
        .w-item:last-child { margin-bottom: 0; }
        .w-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--text-muted); margin-bottom: 4px; letter-spacing: 0.05em; }
        .w-value { font-size: 14px; font-weight: 700; color: #000; }

        .w-content { font-size: 12.5px; line-height: 1.7; color: var(--secondary-color); flex: 1; }
        .w-content h3 { font-size: 13px; font-weight: 800; color: #000; margin: 25px 0 12px; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .w-content ul { padding-left: 20px; margin-bottom: 20px; }
        .w-content li { margin-bottom: 8px; }

        .w-signatures { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; margin-top: 50px; padding-bottom: 40px; }
        .w-sig-box { text-align: center; }
        .w-sig-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 50px; }
        .w-sig-line { border-top: 1px solid #000; padding-top: 10px; font-size: 11px; font-weight: 700; color: #000; }

        .text-end { text-align: right; }
        .text-center { text-align: center; }
    </style>
</head>
<body>
    <div class="page-controls no-print">
        <button id="printBtn" class="btn btn-print">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right:8px">
                <path d="M2 7a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v3h-2v-2H4v2H2V7z"/>
                <path d="M11 2H5v3h6V2z"/>
                <path d="M4 12h8v2H4z"/>
            </svg>
            Imprimer
        </button>
        <button id="returnBtn" class="btn btn-return">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right:8px">
                <path d="M15 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 0 1-1.06 1.06L2.72 8.81a1 1 0 0 1 0-1.62l4-4a.75.75 0 0 1 1.06 1.06L4.56 7.25h9.69A.75.75 0 0 1 15 8z"/>
            </svg>
            Retour
        </button>
    </div>

        <!-- PAGE 1: FACTURE -->
    <div class="page-container">
        <div id="invoice-container" class="container-a4">
            <div class="header">
                <div class="company-section">
                    {% set _logo = settings.logo or settings.logo_path %}
                    {% if _logo %}
                        <img src="{{ _logo }}" alt="Logo" class="logo" style="max-height: 100px; max-width: 300px; object-fit: contain; margin-bottom: 5px;">
                    {% else %}
                        <h1>{{ settings.company_name or 'TECHZONE' }}</h1>
                    {% endif %}
                    <div class="company-info" style="margin-top: 10px;">
                        <p>{{ settings.address or '' }}{% if settings.city %}, {{ settings.city }}{% endif %}</p>
                        {% if settings.phone %}<p>Tél: {{ settings.phone }}</p>{% endif %}
                        {% if settings.email %}<p>Email: {{ settings.email }}</p>{% endif %}
                    </div>
                </div>
                <div class="doc-info">
                    <h2 class="doc-type">Facture</h2>
                    <p class="doc-number">#{{ invoice.invoice_number }}</p>
                    <p class="doc-date">Date: {{ invoice.date | format_date }}</p>
                    {% if warranty_certificate %}
                    <div class="w-badge" style="margin-top: 8px; display: inline-block;">Garantie {{ warranty_certificate.duration }} mois</div>
                    {% endif %}
                </div>
            </div>

            <div class="details-grid">
                <div class="client-info">
                    <div class="detail-section-title">Facturé à</div>
                    {% if invoice.client %}
                    <p class="client-name">{{ invoice.client.name }}</p>
                    {% if invoice.client.address %}<p>{{ invoice.client.address }}</p>{% endif %}
                    {% if invoice.client.phone %}<p>Tél: {{ invoice.client.phone }}</p>{% endif %}
                    {% if invoice.client.email %}<p>Email: {{ invoice.client.email }}</p>{% endif %}
                    {% else %}
                    <p class="client-name">Client</p>
                    {% endif %}
                </div>
                <div class="invoice-meta">
                    <div class="detail-section-title">Informations de Paiement</div>
                    <div class="meta-box">
                        <div class="meta-item">
                            <span class="meta-label">Méthode</span>
                            <span class="meta-value">{{ resolved_payment_method or invoice.payment_method or 'Non spécifié' }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">État</span>
                            <span class="meta-value" style="text-transform: capitalize;">{{ invoice.status or 'En attente' }}</span>
                        </div>
                        {% if invoice.due_date %}
                        <div class="meta-item">
                            <span class="meta-label">Échéance</span>
                            <span class="meta-value">{{ invoice.due_date | format_date }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% set show_prices = invoice.show_item_prices if invoice.show_item_prices is defined else true %}
            {% set show_section_totals = invoice.show_section_totals if invoice.show_section_totals is defined else true %}
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="col-desc">Description</th>
                            {% if show_prices %}
                            <th class="col-qty">Qté</th>
                            <th class="col-price">Prix Unit.</th>
                            <th class="col-total">Montant</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set ns = namespace(section_total=0, in_section=false, section_name='') %}
                        {% for item in grouped_items %}
                            {% if item.is_section %}
                                {# Afficher le total de la section précédente si elle existe #}
                                {% if ns.in_section and show_section_totals %}
                                <tr class="section-total-row">
                                    <td colspan="3">Total {{ ns.section_name }}</td>
                                    <td>{{ ns.section_total | format_cfa }}</td>
                                </tr>
                                {% endif %}
                                
                                {# Nouvelle section #}
                                {% set ns.section_total = 0 %}
                                {% set ns.in_section = true %}
                                {% set ns.section_name = item.name | replace('\u00a0',' ') %}
                                <tr class="section-row">
                                    <td colspan="{{ 4 if show_prices else 1 }}">{{ ns.section_name }}</td>
                                </tr>
                            {% else %}
                                {# Accumuler le total de la section #}
                                {% set ns.section_total = ns.section_total + (item.total or 0) %}
                                <tr>
                                    <td class="col-desc">
                                        <div class="item-name">{{ item.name | replace('\u00a0',' ') | replace(' (IMEI', '<span style="display:none"> (IMEI') | safe }}</div>
                                        {% if item.imeis and item.imeis|length %}
                                        <div class="item-meta">IMEI: {{ item.imeis|join(', ') }}</div>
                                        {% endif %}
                                    </td>
                                    {% if show_prices %}
                                    <td class="col-qty">
                                        {{ item.qty | format_number }}
                                        {% if item.quote_qty is not none %}
                                            <div class="item-meta">Devis: {{ item.quote_qty | format_number }}</div>
                                        {% endif %}
                                    </td>
                                    <td class="col-price">{{ item.price | format_cfa }}</td>
                                    <td class="col-total">{{ item.total | format_cfa }}</td>
                                    {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                        
                        {# Afficher le total de la dernière section si elle existe #}
                        {% if ns.in_section and show_section_totals %}
                        <tr class="section-total-row">
                            <td colspan="3">Total {{ ns.section_name }}</td>
                            <td>{{ ns.section_total | format_cfa }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <div class="summary-section">
                <div class="totals-table">
                    <div class="totals-row">
                        <span class="totals-label">Sous-total</span>
                        <span class="totals-value">{{ (invoice.subtotal or 0) | format_cfa }}</span>
                    </div>
                    {% if invoice.show_tax %}
                    <div class="totals-row">
                        <span class="totals-label">TVA ({{ (invoice.tax_rate or 0)|round(0, 'common')|int }}%)</span>
                        <span class="totals-value">{{ (invoice.tax_amount or 0) | format_cfa }}</span>
                    </div>
                    {% endif %}
                    <div class="totals-row grand-total">
                        <span class="totals-label">Total</span>
                        <span class="totals-value">{{ (invoice.total or 0) | format_cfa }}</span>
                    </div>
                    
                    {% set _st = (invoice.status or '')|lower %}
                    {% if _st in ['partiellement payée', 'partiellement payee', 'partially paid', 'partially_paid'] %}
                    <div class="totals-row payment">
                        <span class="totals-label">Déjà payé</span>
                        <span class="totals-value">{{ (invoice.paid_amount or 0) | format_cfa }}</span>
                    </div>
                    <div class="totals-row due">
                        <span class="totals-label">Reste à payer</span>
                        <span class="totals-value">{{ (invoice.remaining_amount or 0) | format_cfa }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="signature-section">
                <div class="signature-box">
                    <div class="signature-label">Signature & Cachet</div>
                    <div class="signature-line">
                        {% if signature_data_url %}
                        <img src="{{ signature_data_url }}" alt="Signature" class="signature-img" />
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="footer">
                <div class="footer-grid">
                    <div class="footer-col">
                        <h4>Localisation</h4>
                        <p>{{ settings.address or 'Adresse par défaut' }}{% if settings.city %}<br>{{ settings.city }}{% endif %}</p>
                    </div>
                    <div class="footer-col text-center">
                        <h4>Contact Direct</h4>
                        <p>
                            {% if settings.phone %}Tél: {{ settings.phone }}{% endif %}
                            {% if settings.phone2 %}<br>Tél 2: {{ settings.phone2 }}{% endif %}
                            {% if settings.email %}<br>Email: {{ settings.email }}{% endif %}
                        </p>
                    </div>
                    <div class="footer-col text-end">
                        <h4>En Ligne</h4>
                        <p>
                            {% if settings.instagram %}Instagram: @{{ settings.instagram }}{% endif %}
                            {% if settings.website %}<br>Site: {{ settings.website }}{% endif %}
                            {% if not settings.instagram and not settings.website %}techzone.com{% endif %}
                        </p>
                    </div>
                </div>
                {% if settings.footer_text %}
                <div class="footer-bottom">
                    {{ settings.footer_text }}
                </div>
                {% else %}
                <div class="footer-bottom">
                    TECHZONE - Solutions Technologiques & Accessoires
                </div>
                {% endif %}
            </div>
        </div>
    </div>
        </div>
    </div>

    {% if warranty_certificate %}
    <!-- PAGE 2: CERTIFICAT DE GARANTIE -->
    <div class="page-container">
        <div class="warranty-page container-a4">
            <div class="w-header">
                <div class="company-section">
                    {% set _logo = settings.logo or settings.logo_path %}
                    {% if _logo %}<img src="{{ _logo }}" alt="Logo" class="logo">{% endif %}
                </div>
                <div class="doc-info" style="text-align: right;">
                    <div class="w-title">Certificat de Garantie</div>
                    <div class="w-badge" style="margin-top: 8px;">Valable {{ warranty_certificate.duration }} mois</div>
                </div>
            </div>

            <div class="w-grid">
                <div class="w-card">
                    <div class="detail-section-title">Informations Vente</div>
                    <div class="w-item">
                        <span class="w-label">Facture N°</span>
                        <span class="w-value">#{{ warranty_certificate.invoice_number }}</span>
                    </div>
                    <div class="w-item">
                        <span class="w-label">Date d'Achat</span>
                        <span class="w-value">{{ warranty_certificate.date | format_date }}</span>
                    </div>
                    <div class="w-item">
                        <span class="w-label">Client</span>
                        <span class="w-value">{{ invoice.client.name if invoice.client else 'Client' }}</span>
                    </div>
                </div>
                <div class="w-card">
                    <div class="detail-section-title">Période de Garantie</div>
                    <div class="w-item">
                        <span class="w-label">Début</span>
                        <span class="w-value">{{ warranty_certificate.start_date | format_date }}</span>
                    </div>
                    <div class="w-item">
                        <span class="w-label">Fin</span>
                        <span class="w-value">{{ warranty_certificate.end_date | format_date }}</span>
                    </div>
                    <div class="w-item">
                        <span class="w-label">Durée Totale</span>
                        <span class="w-value">{{ warranty_certificate.duration }} Mois</span>
                    </div>
                </div>
            </div>

            <div class="w-content">
                <h3>Conditions Générales de Garantie</h3>
                <p>La présente garantie couvre les défauts de fabrication et les pannes matérielles survenant dans des conditions d'utilisation normales. TECHZONE s'engage à réparer ou remplacer les composants défectueux pendant toute la durée de validité du certificat.</p>
                
                <h3>Étendue de la Couverture</h3>
                <ul>
                    <li>Réparation gratuite des composants matériels défectueux.</li>
                    <li>Remplacement du produit par un modèle équivalent si la réparation est impossible.</li>
                    <li>Support technique pour les problèmes de configuration matérielle.</li>
                </ul>

                <h3>Exclusions de Garantie</h3>
                <p>La garantie ne s'applique pas dans les cas suivants :</p>
                <ul>
                    <li>Dommages causés par une chute, un choc ou une mauvaise manipulation.</li>
                    <li>Exposition à des liquides ou humidité excessive (oxydation).</li>
                    <li>Ouverture ou tentative de réparation par un tiers non agréé.</li>
                    <li>Dommages causés par des surtensions électriques.</li>
                </ul>
            </div>

            <div class="w-signatures">
                <div class="w-sig-box">
                    <div class="w-sig-label">Signature TECHZONE</div>
                    <div class="w-sig-line">Cachet de l'Entreprise</div>
                </div>
                <div class="w-sig-box">
                    <div class="w-sig-label">Signature Client</div>
                    <div class="w-sig-line">Lu et approuvé</div>
                </div>
            </div>

            <div class="footer" style="margin-top: auto; position: static;">
                <div class="footer-grid">
                    <div class="footer-col">
                        <h4>TECHZONE</h4>
                        <p>{{ settings.address or '' }}</p>
                    </div>
                    <div class="footer-col text-center">
                        <h4>Contact</h4>
                        <p>{{ settings.phone or '' }}<br>{{ settings.email or '' }}</p>
                    </div>
                    <div class="footer-col text-end">
                        <h4>Support</h4>
                        <p>Lundi - Samedi<br>09h00 - 19h00</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <script>
        window.onload = function() {
            document.getElementById('printBtn')?.addEventListener('click', function(){ window.print(); });
            document.getElementById('returnBtn')?.addEventListener('click', function(){ window.location.href = '/invoices'; });
            // Auto-print si ouvert en pop-up
            const isInPopup = !!window.opener && window.name === 'invoice_print_popup';
            if (isInPopup) {
                setTimeout(() => window.print(), 400);
            }
        };
        // Fermer la pop-up après impression
        window.onafterprint = function() {
            if (!!window.opener && window.name === 'invoice_print_popup') {
                try { window.close(); } catch(e) {}
            }
        };
    </script>
</body>
</html>